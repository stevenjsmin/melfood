<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mySqlDeliveryCalendarDao">

	<select id="getDeliveryCalendars" parameterType="DeliveryCalendar" resultType="DeliveryCalendar">
	 /* QUERY ID : getDeliveryCalendars */
		SELECT  a.delivery_calendar_id                           'deliveryCalendarId',
				a.seller_id                                      'sellerId',
				b.user_name 									 'seller.userName',
				b.user_id 										 'seller.userId',
				a.yyyy_mm_dd                                     'yyyyMmDd',
				a.am_pm                                          'amPm',
				a.est_deliverytime_from_hhmm                     'estDeliverytimeFromHhmm',
				a.est_deliverytime_to_hhmm                       'estDeliverytimeToHhmm',
				a.delivery_base_address_postcode                 'deliveryBaseAddressPostcode',
				a.delivery_base_address_state                    'deliveryBaseAddressState',
				a.delivery_base_address_suburb                   'deliveryBaseAddressSuburb',
				a.delivery_base_address_street                   'deliveryBaseAddressStreet',
				a.delivery_base_address_note                     'deliveryBaseAddressNote',
				a.delivery_limit_km                              'deliveryLimitKm',
				a.delivery_fee_per_km                            'deliveryFeePerKm',
				a.delivery_basic_fee                             'deliveryBasicFee',
				a.delivery_base_address_gmap_latitude            'deliveryBaseAddressGmapLatitude',
				a.delivery_base_address_gmap_longitude           'deliveryBaseAddressGmapLongitude',
				a.delivery_base_address_gmap_formatted_address   'deliveryBaseAddressGmapFormattedAddress',
				a.use_yn 'useYn',
				a.create_datetime 'createDatetime',
				a.modify_datetime 'modifyDatetime',
				a.creator 'creator'
		FROM shop_delivery_calendar a
		     LEFT OUTER JOIN cmm_user b ON b.user_id = a.seller_id
		WHERE 1 = 1
			<if test="deliveryCalendarId != null and deliveryCalendarId != 0"> AND a.delivery_calendar_id = #{deliveryCalendarId} </if>
			<if test="sellerId != null"> AND a.seller_id = #{sellerId} </if>
			<if test="yyyyMmDd != null"> AND a.yyyy_mm_dd = #{yyyyMmDd} </if>
			<if test="amPm != null"> AND a.am_pm = #{amPm} </if>
			<if test="deliveryBaseAddressPostcode != null"> AND a.delivery_base_address_postcode = #{deliveryBaseAddressPostcode} </if>
			<if test="deliveryBaseAddressState != null"> AND UPPER(a.delivery_base_address_state) = UPPER(#{deliveryBaseAddressState}) </if>
			<if test="deliveryBaseAddressSuburb != null"> AND UPPER(a.delivery_base_address_suburb) LIKE CONCAT('%', UPPER(#{deliveryBaseAddressSuburb}), '%') </if>
			<if test="deliveryBaseAddressStreet != null"> AND UPPER(a.delivery_base_address_street) LIKE CONCAT('%', UPPER(#{deliveryBaseAddressStreet}), '%') </if>
			<if test="useYn != null"> AND UPPER(a.use_yn) = UPPER(#{useYn}) </if>
			<if test="creator != null"> AND UPPER(a.creator) = UPPER(#{creator}) </if>
			<if test="searchDateFrom != null"> AND str_to_date(#{searchDateFrom}, '%Y-%m-%d') <![CDATA[ <=]]> str_to_date(a.yyyy_mm_dd, '%Y-%m-%d') </if>
			<if test="searchDateTo != null"> AND str_to_date(#{searchDateTo}, '%Y-%m-%d') <![CDATA[ >=]]> str_to_date(a.yyyy_mm_dd, '%Y-%m-%d') </if>
			ORDER BY a.delivery_calendar_id DESC, a.seller_id ASC, a.yyyy_mm_dd ASC
		    LIMIT #{pagenationPage}, #{pagenationPageSize}
	</select>

	<select id="getTotalCntForDeliveryCalendars" parameterType="DeliveryCalendar" resultType="java.lang.Integer">
	 /* QUERY ID : getTotalCntForProducts */
		SELECT COUNT(*)
	  FROM shop_delivery_calendar a
		  		LEFT OUTER JOIN cmm_user b ON b.user_id = a.seller_id
  	     WHERE 1 = 1
		<if test="deliveryCalendarId != null and deliveryCalendarId != 0"> AND a.delivery_calendar_id = #{deliveryCalendarId} </if>
		<if test="sellerId != null"> AND a.seller_id = #{sellerId} </if>
		<if test="yyyyMmDd != null"> AND a.yyyy_mm_dd = #{yyyyMmDd} </if>
		<if test="amPm != null"> AND a.am_pm = #{amPm} </if>
		<if test="deliveryBaseAddressPostcode != null"> AND a.delivery_base_address_postcode = #{deliveryBaseAddressPostcode} </if>
		<if test="deliveryBaseAddressState != null"> AND UPPER(a.delivery_base_address_state) = UPPER(#{deliveryBaseAddressState}) </if>
		<if test="deliveryBaseAddressSuburb != null"> AND UPPER(a.delivery_base_address_suburb) LIKE CONCAT('%', UPPER(#{deliveryBaseAddressSuburb}), '%') </if>
		<if test="deliveryBaseAddressStreet != null"> AND UPPER(a.delivery_base_address_street) LIKE CONCAT('%', UPPER(#{deliveryBaseAddressStreet}), '%') </if>
		<if test="useYn != null"> AND UPPER(a.use_yn) = UPPER(#{useYn}) </if>
		<if test="creator != null"> AND UPPER(a.creator) = UPPER(#{creator}) </if>
		<if test="searchDateFrom != null"> AND str_to_date(#{searchDateFrom}, '%Y-%m-%d') <![CDATA[ <=]]> str_to_date(a.yyyy_mm_dd, '%Y-%m-%d') </if>
		<if test="searchDateTo != null"> AND str_to_date(#{searchDateTo}, '%Y-%m-%d') <![CDATA[ >=]]> str_to_date(a.yyyy_mm_dd, '%Y-%m-%d') </if>
	</select>


	<insert id="insertDeliveryCalendar" parameterType="DeliveryCalendar">
	 /* QUERY ID : insertDeliveryCalendar */
		INSERT INTO shop_delivery_calendar (
		 						 seller_id
								,yyyy_mm_dd
								,am_pm
								,est_deliverytime_from_hhmm
								,est_deliverytime_to_hhmm
								,delivery_base_address_postcode
								,delivery_base_address_state
								,delivery_base_address_suburb
								,delivery_base_address_street
								,delivery_base_address_note
								,delivery_limit_km
								,delivery_fee_per_km
								,delivery_basic_fee
								,delivery_base_address_gmap_latitude
								,delivery_base_address_gmap_longitude
								,delivery_base_address_gmap_formatted_address)
		VALUES (#{sellerId}
	        ,#{yyyyMmDd}
	        ,UPPER(#{amPm})
	        ,TRIM(#{estDeliverytimeFromHhmm})
	        ,TRIM(#{estDeliverytimeToHhmm})
	        ,#{deliveryBaseAddressPostcode}
	        ,#{deliveryBaseAddressState}
	        ,#{deliveryBaseAddressSuburb}
	        ,#{deliveryBaseAddressStreet}
	        ,#{deliveryBaseAddressNote}
	        ,#{deliveryLimitKm}
	        ,#{deliveryFeePerKm}
	        ,#{deliveryBasicFee}
	        ,#{deliveryBaseAddressGmapLatitude}
	        ,#{deliveryBaseAddressGmapLongitude}
	        ,#{deliveryBaseAddressGmapFormattedAddress} )
	</insert>
	<update id="modifyDeliveryCalendarForNotNull" parameterType="DeliveryCalendar">
		/* QUERY ID : modifyDeliveryCalendarForNotNull */
		UPDATE shop_delivery_calendar
			SET modify_datetime = CURRENT_TIMESTAMP
				<if test="sellerId != null"> ,seller_id = #{sellerId} </if>
				<if test="yyyyMmDd != null"> ,yyyy_mm_dd = #{yyyyMmDd} </if>
				<if test="amPm != null"> ,am_pm = UPPER(TRIM(#{amPm})) </if>
				<if test="estDeliverytimeFromHhmm != null"> ,est_deliverytime_from_hhmm = #{estDeliverytimeFromHhmm} </if>
				<if test="estDeliverytimeToHhmm != null"> ,est_deliverytime_to_hhmm = #{estDeliverytimeToHhmm} </if>
				<if test="deliveryBaseAddressPostcode != null"> ,delivery_base_address_postcode = #{deliveryBaseAddressPostcode} </if>
				<if test="deliveryBaseAddressState != null"> ,delivery_base_address_state = #{deliveryBaseAddressState} </if>
				<if test="deliveryBaseAddressSuburb != null"> ,delivery_base_address_suburb = #{deliveryBaseAddressSuburb} </if>
				<if test="deliveryBaseAddressStreet != null"> ,delivery_base_address_street = #{deliveryBaseAddressStreet} </if>
				<if test="deliveryBaseAddressNote != null"> ,delivery_base_address_note = #{deliveryBaseAddressNote} </if>
				<if test="deliveryLimitKm != null"> ,delivery_limit_km = #{deliveryLimitKm} </if>
				<if test="deliveryFeePerKm != null"> ,delivery_fee_per_km = #{deliveryFeePerKm} </if>
				<if test="deliveryFeePerKm != null"> ,delivery_basic_fee = #{deliveryFeePerKm} </if>
				<if test="deliveryBaseAddressGmapLatitude != null"> ,delivery_base_address_gmap_latitude = #{deliveryBaseAddressGmapLatitude} </if>
				<if test="deliveryBaseAddressGmapLongitude != null"> ,delivery_base_address_gmap_longitude = #{deliveryBaseAddressGmapLongitude} </if>
				<if test="deliveryBaseAddressGmapFormattedAddress != null"> ,delivery_base_address_gmap_formatted_address = #{deliveryBaseAddressGmapFormattedAddress} </if>
				<if test="useYn != null"> ,use_yn = UPPER(TRIM(#{useYn})) </if>
		WHERE delivery_calendar_id = #{deliveryCalendarId}
	</update>


	<delete id="deleteDeliveryCalendar" parameterType="DeliveryCalendar">
		/* QUERY ID : deleteDeliveryCalendar */
		DELETE FROM shop_delivery_calendar WHERE delivery_calendar_id = #{deliveryCalendarId}
	</delete>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mySqlDeliveryCalendarDao">

	<select id="getDeliveryCalendars" parameterType="DeliveryCalendar" resultType="DeliveryCalendar">
	 /* QUERY ID : getDeliveryCalendars */
		SELECT  a.delivery_calendar_id                           'deliveryCalendarId',
				a.seller_id                                      'sellerId',
				b.user_name 									 'seller.userName',
				b.userId 										 'seller.userId',
				a.yyyy_mm_dd                                     'yyyyMmDd',
				a.am_pm                                          'amPm',
				a.est_deliverytime_from_hhmm                     'estDeliverytimeFromHhmm',
				a.est_deliverytime_to_hhmm                       'estDeliverytimeToHhmm',
				a.delivery_base_address_postcode                 'deliveryBaseAddressPostcode',
				a.delivery_base_address_state                    'deliveryBaseAddressState',
				a.delivery_base_address_suburb                   'deliveryBaseAddressSuburb',
				a.delivery_base_address_street                   'deliveryBaseAddressStreet',
				a.delivery_base_address_note                     'deliveryBaseAddressNote',
				a.delivery_limit_km                              'deliveryFeePerKm',
				a.delivery_fee_per_km                            'deliveryBasicFee',
				a.delivery_basic_fee                             'deliveryLimitKm',
				a.delivery_base_address_gmap_latitude            'deliveryBaseAddressGmapLatitude',
				a.delivery_base_address_gmap_longitude           'deliveryBaseAddressGmapLongitude',
				a.delivery_base_address_gmap_formatted_address   'deliveryBaseAddressGmapFormattedAddress',
				a.use_yn 'useYn',
				a.create_datetime 'createDatetime',
				a.modify_datetime 'modifyDatetime',
				a.creator 'creator'
		FROM shop_delivery_calendar a
		     LEFT OUTER JOIN cmm_user b ON b.user_id = a.seller_id
		WHERE 1 = 1
			<if test="deliveryCalendarId != null and deliveryCalendarId != 0"> AND a.delivery_calendar_id = #{deliveryCalendarId} </if>
			<if test="sellerId != null"> AND a.seller_id = #{sellerId} </if>
			<if test="yyyyMmDd != null"> AND a.yyyy_mm_dd = #{yyyyMmDd} </if>
			<if test="amPm != null"> AND a.am_pm = #{amPm} </if>
			<if test="deliveryBaseAddressPostcode != null"> AND a.delivery_base_address_postcode = #{deliveryBaseAddressPostcode} </if>
			<if test="deliveryBaseAddressState != null"> AND UPPER(a.delivery_base_address_state) = UPPER(#{deliveryBaseAddressState}) </if>
			<if test="deliveryBaseAddressSuburb != null"> AND UPPER(a.delivery_base_address_suburb) LIKE CONCAT('%', UPPER(#{deliveryBaseAddressSuburb}), '%') </if>
			<if test="deliveryBaseAddressStreet != null"> AND UPPER(a.delivery_base_address_street) LIKE CONCAT('%', UPPER(#{deliveryBaseAddressStreet}), '%') </if>
			<if test="useYn != null"> AND UPPER(a.use_yn) = UPPER(#{useYn}) </if>
			<if test="creator != null"> AND UPPER(a.creator) = UPPER(#{creator}) </if>
			<if test="searchDateFrom != null"> AND str_to_date(#{searchDateFrom}, '%Y-%m-%d') <![CDATA[ <=]]> str_to_date(a.yyyy_mm_dd, '%Y-%m-%d') </if>
			<if test="searchDateTo != null"> AND str_to_date(#{searchDateTo}, '%Y-%m-%d') <![CDATA[ >=]]> str_to_date(a.yyyy_mm_dd, '%Y-%m-%d') </if>
			ORDER BY b.user_name ASC, a.yyyy_mm_dd ASC, a.btwn_from_hhmm ASC
		    LIMIT #{pagenationPage}, #{pagenationPageSize}
	</select>

	<select id="getTotalCntForDeliveryCalendars" parameterType="DeliveryCalendar" resultType="java.lang.Integer">
	 /* QUERY ID : getTotalCntForProducts */
		SELECT COUNT(*)
	  FROM shop_delivery_calendar a
		  		LEFT OUTER JOIN cmm_user b ON b.user_id = a.seller_id
  	     WHERE 1 = 1
		<if test="deliveryCalendarId != null and deliveryCalendarId != 0"> AND a.delivery_calendar_id = #{deliveryCalendarId} </if>
		<if test="sellerId != null"> AND a.seller_id = #{sellerId} </if>
		<if test="yyyyMmDd != null"> AND a.yyyy_mm_dd = #{yyyyMmDd} </if>
		<if test="amPm != null"> AND a.am_pm = #{amPm} </if>
		<if test="deliveryBaseAddressPostcode != null"> AND a.delivery_base_address_postcode = #{deliveryBaseAddressPostcode} </if>
		<if test="deliveryBaseAddressState != null"> AND UPPER(a.delivery_base_address_state) = UPPER(#{deliveryBaseAddressState}) </if>
		<if test="deliveryBaseAddressSuburb != null"> AND UPPER(a.delivery_base_address_suburb) LIKE CONCAT('%', UPPER(#{deliveryBaseAddressSuburb}), '%') </if>
		<if test="deliveryBaseAddressStreet != null"> AND UPPER(a.delivery_base_address_street) LIKE CONCAT('%', UPPER(#{deliveryBaseAddressStreet}), '%') </if>
		<if test="useYn != null"> AND UPPER(a.use_yn) = UPPER(#{useYn}) </if>
		<if test="creator != null"> AND UPPER(a.creator) = UPPER(#{creator}) </if>
		<if test="searchDateFrom != null"> AND str_to_date(#{searchDateFrom}, '%Y-%m-%d') <![CDATA[ <=]]> str_to_date(a.yyyy_mm_dd, '%Y-%m-%d') </if>
		<if test="searchDateTo != null"> AND str_to_date(#{searchDateTo}, '%Y-%m-%d') <![CDATA[ >=]]> str_to_date(a.yyyy_mm_dd, '%Y-%m-%d') </if>
	</select>


	<insert id="insertDeliveryCalendar" parameterType="DeliveryCalendar">
	 /* QUERY ID : insertDeliveryCalendar */
		INSERT INTO shop_delivery_calendar (
		 						 seller_id
								,yyyy_mm_dd
								,am_pm
								,est_deliverytime_from_hhmm
								,est_deliverytime_to_hhmm
								,delivery_base_address_postcode
								,delivery_base_address_state
								,delivery_base_address_suburb
								,delivery_base_address_street
								,delivery_base_address_note
								,delivery_limit_km
								,delivery_fee_per_km
								,delivery_basic_fee
								,delivery_base_address_gmap_latitude
								,delivery_base_address_gmap_longitude
								,delivery_base_address_gmap_formatted_address)
		VALUES (#{sellerId}
	        ,#{yyyyMmDd}
	        ,UPPER(#{am_pm})
	        ,TRIM(#{estDeliverytimeFromHhmm})
	        ,TRIM(#{estDeliverytimeToHhmm})
	        ,#{deliveryBaseAddressPostcode}
	        ,#{deliveryBaseAddressState}
	        ,#{deliveryBaseAddressSuburb}
	        ,#{deliveryBaseAddressStreet}
	        ,#{deliveryBaseAddressNote}
	        ,#{deliveryLimitKm}
	        ,#{deliveryFeePerKm}
	        ,#{deliveryBasicFee}
	        ,#{deliveryBaseAddressGmapLatitude}
	        ,#{deliveryBaseAddressGmapLongitude}
	        ,#{deliveryBaseAddressGmapFormattedAddress} )
	</insert>

	<delete id="deleteDeliveryCalendar" parameterType="DeliveryCalendar">
		/* QUERY ID : deleteDeliveryCalendar */
		DELETE FROM shop_delivery_calendar WHERE delivery_calendar_id = #{deliveryCalendarId}
	</delete>

</mapper>